---
# Cluster: dk1d-baseline
# Site: dk1d
# Environment: development
# Created: Sat Dec 20 06:07:51 UTC 2025
#
# Apply instructions:
#   ./scripts/apply-cluster.sh baseline.yaml
#
# This will create all resources: MachineClasses, Cluster, and MachineSets

---
# Control plane machine class
metadata:
  namespace: default
  type: MachineClasses.omni.sidero.dev
  id: dk1d-baseline-control-plane
spec:
  matchlabels:
    - site = dk1d
    - platform = proxmox
    - size = small

---
# Worker machine class
metadata:
  namespace: default
  type: MachineClasses.omni.sidero.dev
  id: dk1d-baseline-worker
spec:
  matchlabels:
    - site = dk1d
    - platform = proxmox
    - size = small

---
# Cluster resource
metadata:
  namespace: default
  type: Clusters.omni.sidero.dev
  id: dk1d-baseline
spec:
  kubernetesversion: 1.30.0
  talosversion: 1.9.0
  features:
    enableworkloadproxy: true
    diskencryption: false
    useembeddeddiscoveryservice: true

---
# Control plane machine set
metadata:
  namespace: default
  type: MachineSets.omni.sidero.dev
  id: dk1d-baseline-control-planes
  labels:
    omni.sidero.dev/cluster: dk1d-baseline
    omni.sidero.dev/role-controlplane: ""
spec:
  machineclass:
    name: dk1d-baseline-control-plane
    machinecount: 1
    allocationtype: 0
  patches:
  - |
    machine:
      install:
        disk: /dev/sda
      kubelet:
        nodeIP:
          validSubnets:
            - 0.0.0.0/0  # Use primary interface IP
        extraArgs:
          rotate-server-certificates: "true"
      network:
        interfaces:
          - interface: eth0
            dhcp: true
      time:
        servers:
          - time.cloudflare.com
          - time.google.com
    cluster:
      controllerManager:
        extraArgs:
          bind-address: "0.0.0.0"
      scheduler:
        extraArgs:
          bind-address: "0.0.0.0"
      apiServer:
        certSANs:
          - dk1d-baseline.local
          - dk1d-baseline.example.com
      proxy:
        disabled: false
      discovery:
        enabled: true
        registries:
          service:
            disabled: false

---
# Worker machine set
metadata:
  namespace: default
  type: MachineSets.omni.sidero.dev
  id: dk1d-baseline-workers
  labels:
    omni.sidero.dev/cluster: dk1d-baseline
    omni.sidero.dev/role-worker: ""
spec:
  machineclass:
    name: dk1d-baseline-worker
    machinecount: 3
    allocationtype: 0
  patches:
  - |
    machine:
      install:
        disk: /dev/sda
      kubelet:
        nodeIP:
          validSubnets:
            - 0.0.0.0/0
        extraArgs:
          rotate-server-certificates: "true"
      network:
        interfaces:
          - interface: eth0
            dhcp: true
      time:
        servers:
          - time.cloudflare.com
          - time.google.com

---
# Resource requirements for Terraform
# These values should match your terraform.tfvars configuration

# Node specifications:
# - Control Planes: 1
# - Workers: 3
# - Total Nodes: 4
# - Size Class: small
#
# Per-node resources:
# - CPU: 2 cores
# - Memory: 4096 MB
# - Disk: 100 GB
#
# Total resources:
# - CPU: 8 cores
# - Memory: 16384 MB (16 GB)
# - Disk: 400 GB

# Update terraform/vsphere/terraform.tfvars.dk1d:
#   node_count     = 4
#   node_cpu       = 2
#   node_memory    = 4096
#   node_disk_size = 100
